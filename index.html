<!doctype html><html lang="en"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kranker ¬∑ Atlas Viewer</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="./assets/app.css">
<body>
<header>
  <div class="brand">üü° kranker ¬∑ atlas</div>
  <input id="base" value="https://jimage3.github.io/canon-core">
  <button id="load">Load</button>
  <button id="export">Export SVG</button>
</header>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const $=s=>document.querySelector(s);
const map=L.map('map',{zoomControl:true}).setView([0,0],2);
L.tileLayer(document.getElementById("map").style.background = "#0e0e10";).addTo(map);
const layers={};
function addLayer(name,geo){ if(layers[name]) map.removeLayer(layers[name]);
  layers[name]=L.geoJSON(geo,{style:{color:'#ffd54a',weight:1,fillOpacity:0.15}}).addTo(map); }
async function fetchJSON(u){ const r=await fetch(u); if(!r.ok) throw new Error(u); return r.json(); }
async function load(){
  const base=$('#base').value.replace(/\/$/,'');
  const loka=await fetchJSON(`${base}/master/atlases/worlds/loka.geojson`);
  const drav=await fetchJSON(`${base}/master/atlases/continents/dravon.geojson`);
  const lart=await fetchJSON(`${base}/master/atlases/countries/lart.geojson`);
  const ram =await fetchJSON(`${base}/master/atlases/cities/ramal.geojson`);
  addLayer('loka',loka); addLayer('dravon',drav); addLayer('lart',lart); addLayer('ramal',ram);addLayer('loka', loka, '#ffd54a');
addLayer('dravon', dravon, '#ff5555');
addLayer('lart', lart, '#55ff55');
addLayer('ramal', ram, '#5555ff');
  map.fitBounds(layers['ramal'].getBounds());
  <script>
function exportSVG(){
  // ‡∏î‡∏∂‡∏á SVG ‡∏Ç‡∏≠‡∏á Leaflet overlay
  const svg = document.querySelector('#map .leaflet-overlay-pane svg');
  if(!svg){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏ô SVG ‚Äî ‡∏Å‡∏î Load ‡∏Å‡πà‡∏≠‡∏ô'); return; }

  // ‡πÉ‡∏™‡πà viewBox ‡πÉ‡∏´‡πâ‡∏™‡πÄ‡∏Å‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
  const bbox = svg.getBBox();
  svg.setAttribute('viewBox', `${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`);
  svg.setAttribute('xmlns','http://www.w3.org/2000/svg');

  // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
  const blob = new Blob([svg.outerHTML], {type:'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'atlas-export.svg';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
document.querySelector('#export').addEventListener('click', exportSVG);
</script>
}
$('#load').addEventListener('click',load);
</script>
</body></html>
